<HTML>
<HEADER>
<TITLE>
MGI: Reversing a Marker Withdrawal
</TITLE>
</HEADER>

<BODY>
<!--#include file="include.html"-->

<H2>MGI: Reversing a Marker Withdrawal</H2>

<H4>Introduction</H4>
A Marker Withdrawal is a special type of Nomenclature event with four different definitions:
<OL>
<LI>A single withdrawal occurs when more information is discovered about a symbol and
    Nomenclature rules dictate different symbol nomenclature.  Changes in Nomenclature
    rules can also drive a symbol withdrawal.
<P>
<LI>A single withdrawal occurs when two previously defined symbols are discovered to be the same
    entity. One of the symbols is chosen as the approved symbol and the other symbol is withdrawn
    from use. 
<P>
<LI>A single allele withdrawal occurs when a previously defined symbol is discovered to be an 
    allele of another symbol. An example is the c albino "gene" which was eventually discovered 
    to be an allele of <I>Tyr</I>.
<P>
<LI>A split occurs when a single symbol is discovered to be more than one physical entity. 
    In this case, the symbol is withdrawn and multiple new symbols are created. 
</OL>
<P>
More complete details of a Marker withdrawal are described in the 
<A HREF="MEIBroadcast.html">MGI: Marker Broadcast</A> document in the
"What does the Broadcast update do?" section .
<P>
The purpose of this document is to provide SE procedures to reinstall a Marker's original
state in the database when a Marker is withdrawn in error.
<P>
The state of a Marker refers to its basic characteristics (symbol, chromosome, name, offsets,
accession numbers, other names, other symbols, etc.) in addition to data associated with the 
Marker throughout the rest of the database (Mapping, Homology, Molecular Segment, MLC, GXD, etc.).
<P>

<H4>Reversal Procedures</H4>
There are several files which are available for your use when determining the events
of the Marker withdrawal.  These files are described in the section
<A HREF="#files">Marker Withdrawal Status and Diagnostic Files</A>.
<P>
For most cases, it is essential to have a snapshot of the state of the Marker prior to its
withdrawal.  It is also essential to have a snapshot of the state of the new Marker(s) involved 
in the withdrawal, if the new symbol(s) exist in the database prior to the withdrawal.
See the section <A HREF="#state">Determine the state of Markers prior to a Withdrawal</A> 
for instructions on how to retrieve this information.
<P>
There is more than one procedure for reversing a Marker Withdrawal.  The procedure you use
will be determined by several different factors:
<OL>
<LI><A HREF="#exist">Did the new symbol exist in the database prior to the withdrawal?</A>
<LI>Is the withdrawal a split?
<LI>Have there been subsequenct withdrawals since the withdrawal you wish to reverse?
</OL>
<P>
Procedures for the most common cases:
<OL>
<LI><A HREF="#case1">Case 1:  Reversal Procedures if the new Symbol did <I>not</I> exist in the database prior to the Withdrawal</A>
<LI><A HREF="#case2">Case 2:  Reversal Procedures if the new Symbol did exist in the database prior to the Withdrawal</A>
</OL>

<HR>
<H4><A NAME="files">Marker Withdrawal Status and Diagnostic Files</A></H4>
The Broadcast program processes all Marker withdrawals, both those initiated from the
Nomenclature database and those initiated from the Marker Editing form.  The Broadcast
process outputs several files to the Broadcast archive directory:
    <PRE>
    <A HREF="http://titan/~lec/mgireport/BROADCAST/">titan:/export/mgd/mgireport/BROADCAST</A>
    </PRE>
<P>
If the files cannot be found in the archive directory, then check the directory:
	<PRE>
    	/home/djr/mgireport
	</PRE>
<P>
These files are useful for reversing a withdrawal because they provide information regarding
the state of the Marker prior to its withdrawal and the actual SQL commands which were executed
during the withdrawal process.  The files may be in the main archive directory or in one
of the archive's subdirectories.
<OL>
<LI><I>&lt;broadastfile&gt;.diagnostics</I>
     <BR>
     Listing of all SQL generated during the Broadast process.
<P>
<LI><I>&lt;broadastfile&gt;.stats</I>
    <BR>
    User status file of what occurred during the Broadcast.  This file will be useful
    for determining if the new symbol existed prior to the withdrawal or if the
    new symbol was inserted during the withdrawal process.
<P>
<LI><I>&lt;broadastfile&gt;.MLC.diagnostics</I>
     <BR>
     Listing of all SQL generated during the MLC update process.
<P>
<LI><I>&lt;broadastfile&gt;.MLC.stats</I>
    <BR>
    User status file of what occurred during the MLC update.
<P>
<LI><I>MRK_Broadcast.sql.MarkerSymbol.rpt</I>
    <BR>
    Contains SQL output of queries performed on the given Marker symbol against
    all relevant database tables (<I>MRK_Marker</I>, <I>MRK_Name</I>, etc.)  For
    each Marker which is withdrawn in a Broadcast, a report will be generated for
    the Marker being withdrawn and for each of the new symbol(s) involved in the
    withdrawal (if the new symbol(s) exist in the database prior to the withdrawal).
    These files will be useful in determining the state of Markers prior to the withdrawal.
<P>
</OL>

<HR>
<H4><A NAME="state">Determine the State of Markers prior to a Withdrawal</A></H4>
The state of both the withdrawn Marker and the new symbol(s) is saved during the Broadcast process.
Refer to <A HREF="#files">Marker Withdrawal Status and Diagnostic Files</A> for details
about the name and location of the files which contain the Marker state information.
<P>
If the files cannot be found, then you will need to do some detective work to determine
the state of the Markers prior to the withdrawal:
<P>
<OL>
<LI>If the withdrawal occurred <B>today</B>, then the public database can be used to determine
    the original state of the Markers prior to its withdrawal.  You can run the report:
	<PRE>
	titan:/export/mgd/MRK_Broadcast.sql MGD_PUBLIC $db _Marker_key symbol
	</PRE>
    using the appropriate public database (pub_1 or pub_2), <I>MRK_Marker._Marker_key</I> 
    and <I>MRK_Marker.symbol</I> values.  The output files will appear in your <I>~/mgireport</I>
    directory.
<P>
<LI>If the withdrawal occured <B>yesterday</B>, then the alternate public database can be
    used to determine the original state of the Markers prior to its withdrawal.  (Remember
    that the pub_1 and pub_2 public databases are alternately loaded from Production on
    a daily basis).  You can run the report:
	<PRE>
	titan:/export/mgd/MRK_Broadcast.sql MGD_PUBLIC $db _Marker_key symbol
	</PRE>
    using the appropriate public database (pub_1 or pub_2), <I>MRK_Marker._Marker_key</I> 
    and <I>MRK_Marker.symbol</I> values.  The output files will appear in your <I>~/mgireport</I>
    directory.
<P>
<LI>If the withdrawal occured more than 2 days ago, then you will have to contact John Gilbert
    (DBA) to see if he has a backup of the database prior to the date of the Marker withdrawal.
<P>
<LI>Another resource to check is one of the MGI mirror sites which may have an older copy
    of the database which contains the state of the Marker prior to its withdrawal.
<P>
<LI>If all efforts to determine the state of the Markers prior to its withdrawal fail,
    then you will need to contact Deb Reed and explain the situation to her.  With a bit
    more detective work, she may be able to provide this information.
<P>
<LI>If the state of the Markers prior to its withdrawal still cannot be determined, then you
    cannot reverse the withdrawal without more help.  Contact Judy Blake.
<P>
</OL>

<HR>
<H4><A NAME="exist">Did the new symbol exist in the database prior to the withdrawal?</A></H4>
This information is available in the Broadcast archive file <I>&lt;broadcastfile&gt;.stats</I>.
<P>
Refer to <A HREF="#files">Marker Withdrawal Status and Diagnostic Files</A> for details
about the location of this file.
<P>
You will need to find the <I>&lt;broadcastfile&gt;.stats</I> file which contains the withdrawal
of the symbol of interest.  Simply <CODE>grep</CODE> all of the <I>.stats</I> files in the
Broadcast archive directory for the symbol of interest.  The entry in the <I>.stats</I>
file will look something like this:
	<PRE>
	Rgsr    G       W       withdrawn, = Rgs16      J:46072
        Broadcast Report Generated
        New Symbol Rgs16 Inserted (38715)
        Symbol Changed in MLC Edit Tables
        Symbol Withdrawn

	Flk1    G       W       withdrawn, = Kdr        J:1615
        Broadcast Report Generated
        Symbol Kdr Already Exists
        Flk1 Offset 42.0 does not match Kdr Offset -999.0
        Flk1 EC number 2.7.1.112 does not match Kdr EC number None
        Symbol Changed in MLC Edit Tables
        Symbol has Alleles
        Symbol Withdrawn
	</PRE>

<P>
In the case of the withdrawal of <I>Rgsr</I> to <I>Rgs16</I>, the
new symbol <I>Rgs16</I> did not exist in the database prior to the withdrawal.
<P>
However, in the case of the withdrawal of <I>Flk1</I> to <I>Kdr</I>, the new symbol
<I>Kdr</I> did exist in the database prior to the withdrawal.

<HR>
<H4><A NAME="case1">Case 1:  Reversal Procedures if the new Symbol did <I>not</I> exist in the database prior to the Withdrawal</A></H4>

We will use the symbol <I>Ly49a</I> which was withdrawn to <I>Klra1</I> on February 6, 1999
as an example to explain these procedures.
<P>
Since the new symbol <I>Klra1</I> did not exist prior to the withdrawal and it now 
contains all of the information once associated with the old symbol <I>Ly49a</I>, the 
easiest thing to do is to:
<P>
<OL>
<LI>Change the new symbol, <I>Klra1</I> back to <I>Ly49a</I> by simply updating
    some Marker information.
<LI>Remove the old symbol, <I>Ly49a</I>.
</OL>
<P>
Deborah Reed can reverse this withdrawal by applying the following edits to the <I>Klra1</I>
symbol via the Marker Editing form:
<P>
<OL>
<LI>Delete the history lines which refer to the withdrawal and the assignment events:
<PRE>
Ly49a  lymphocyte antigen 49...    01/06/1999  23000  withdrawn, = Klra1
Klra1  killer cell lectin-like...  01/06/1999  23000  Assigned
</PRE>
<P>
<LI>Update any original <I>Ly49a</I> history lines to <I>Klra1</I> (otherwise
    you will not be able to delete the original <I>Ly49a</I> symbol later on):
<PRE>
Ly49a  lymphocyte antigen 49...    01/20/1995  19490  Assigned
</PRE>
to:
<PRE>
Klra1  lymphocyte antigen 49...    01/20/1995  19490  Assigned
</PRE>
<P>
<LI>Change the Marker name to the original Marker name:
<PRE>
lymphocyte antigen 49 complex, locus A
</PRE>
<P>
<LI>Change the Marker symbol <I>Klra1</I> to the orignal Marker symbol:
<PRE>
Ly49a
</PRE>
<P>
<LI>Delete the original symbol <I>Ly49a</I>.
<P>
<LI>Check the Web display for the original Marker symbol <I>Ly49a</I>.  Note that
    the Web mini-map may still reflect the withdrawn symbol <I>Klra1</I> until the
    mini-map is regenerated the following day.  There should only be one record
    returned when querying for symbol <I>Ly49a</I>.
<P>
</OL>

<HR>
<H4><A NAME="case2">Case 2:  Reversal Procedures if the new Symbol did exist in the database prior to the Withdrawal</A></H4>
In the case where the new Symbol did exist as it own entity in the database prior to the
withdrawal, the withdrawn symbol and its original data need to be moved back to the original
symbol record.
<OL>
<LI><A HREF="#state">Determine the state of Markers prior to a Withdrawal.</A>
<LI><A HREF="#markerUpdate">Reverse changes to master Marker record.</A>
<LI><A HREF="#accUpdate">Reverse changes to the Accession record(s).</A>
<LI><A HREF="#aliasUpdate">Reverse changes to the Alias record(s).</A>
<LI><A HREF="#alleleUpdate">Reverse changes to the Allele record(s).</A>
<LI><A HREF="#anchorUpdate">Reverse changes to the Anchor record(s).</A>
<LI><A HREF="#classUpdate">Reverse changes to the Class record(s).</A>
<LI><A HREF="#historyUpdate">Reverse changes to the History record(s).</A>
<LI><A HREF="#offsetUpdate">Reverse changes to the Offset record(s).</A>
<LI><A HREF="#otherUpdate">Reverse changes to the Other Names record(s).</A>
<LI><A HREF="#mlcUpdate">Reverse changes to the MLC record(s).</A>
<LI><A HREF="#nameSymbolReferenceUpdate">Reverse changes to the Marker Name, Marker Symbol and Marker Reference record(s).</A>
</OL>

<HR>
<H4><A NAME="markerUpdate">Reverse changes to master Marker record</A></H4>

The following fields need to be set back to their original values in the 
<I>MRK_Marker</I> table:
<OL>
<LI>Marker Name (<I>MRK_Marker.name</I>)
<LI>Chromosome (<I>MRK_Marker.chromosome</I>)
</OL>

Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of the withdrawn symbol,
 <I>Marker Info</I> section:
<PRE>
	update MRK_Marker
	set name = <I>original name</I>,
	    chromosome = <I>original chromosome</I>
	    where _Marker_key = <I>original key</I>
</PRE>

<HR>
<H4><A NAME="accUpdate">Reverse changes to the Accession record(s)</A></H4>

The following fields need to be set back to their original values in the
<I>ACC_Accession</I> table:
<OL>
<LI>Object key (<I>ACC_Accession._Object_key</I>)
<LI>Preferred bit of MGI Accession ID (<I>ACC_Accession.preferred</I>)
</OL>

Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of the withdrawn symbol,
 <I>Marker Accession Number</I> section:
<PRE>
	update ACC_Accession
	set _Object_key = <I>original key</I>
	where _Accession_key = <I>accession key</I>

	update ACC_Accession
	set preferred = 1
	where _Accession_key = <I>accession key of original MGI Accession ID</I>
</PRE>

<HR>
<H4><A NAME="aliasUpdate">Reverse changes to the Alias record(s)</A></H4>

The following fields need to be set back to their original values in the
<I>MRK_Alias</I> table:
<OL>
<LI>Marker key (<I>MRK_Alias._Marker_key</I>)
</OL>

Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of the withdrawn symbol,
<I>Marker Aliases</I> section:
<PRE>
	update MRK_Alias
	set _Marker_key = <I>original key</I>
	where _Marker_key = <I>new key</I>
</PRE>

<HR>
<H4><A NAME="alleleUpdate">Reverse changes to the Allele record(s)</A></H4>
 
The following fields need to be set back to their original values in the
<I>MRK_Allele</I> table:
<OL>
<LI>Marker key (<I>MRK_Allele._Marker_key</I>)
</OL>
 
Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of the withdrawn symbol, 
<I>Marker Alleles</I> section:
<PRE>
        update MRK_Allele
        set _Marker_key = <I>original key</I>
        where _Marker_key = <I>new key</I>
</PRE>
 
<HR>
<H4><A NAME="anchorUpdate">Reverse changes to the Anchor record(s)</A></H4>
 
The following fields need to be set back to their original values in the
<I>MRK_Anchors</I> table:
<OL>
<LI>Marker key (<I>MRK_Anchors._Marker_key</I>)
</OL>
 
Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of the withdrawn symbol,
<I>Marker Anchors</I> section:
<PRE>
        update MRK_Anchors
        set _Marker_key = <I>original key</I>
        where _Marker_key = <I>new key</I>
</PRE>
 
<HR>
<H4><A NAME="classUpdate">Reverse changes to the Marker Class record(s)</A></H4>
 
The following fields need to be set back to their original values in the
<I>MRK_Classes</I> table:
<OL>
<LI>Marker key (<I>MRK_Classes._Marker_key</I>)
</OL>
 
Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of both the withdrawn and new symbol(s),
<I>Marker Classes</I> section:
<PRE>
        update MRK_Classes
        set _Marker_key = <I>original key</I>
        where _Marker_key = <I>new key</I>
</PRE>
 
In the case of Marker Classes, you do not want to eliminate Class associations with the
new symbol which may have existed for both the original and new symbols prior to the withdrawal.
So, you must check the state of the Marker Classes for both original and new symbols prior to
the withdrawal.

<HR>
<H4><A NAME="historyUpdate">Reverse changes to the History record(s)</A></H4>
 
The following fields need to be set back to their original values in the
<I>MRK_History</I> table:
<OL>
<LI>Marker key (<I>MRK_History._Marker_key</I>)
</OL>
 
Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file of both the withdrawn and
new symbol(s), <I>Marker History</I> section:
<PRE>
        update MRK_History
        set _Marker_key = <I>original key</I>
        where _Marker_key = <I>new key</I> and sequenceNum = <I>sequence number</I>
</PRE>
 
<HR>
<H4><A NAME="offsetUpdate">Reverse changes to the Offset record(s)</A></H4>
 
The following fields need to be set back to their original values in the
<I>MRK_Offset</I> table:
<OL>
<LI>MGD Offset (<I>MRK_Offset.offset where source = 0</I>)
<LI>CC Offset (<I>MRK_Offset.offset where source = 1</I>)
<LI>MIT Offset (<I>MRK_Offset.offset where source = 2</I>)
</OL>
<P>
The MGD offset was changed to <I>-999.9</I> during the withdrawal process.
<P>
The CC and MIT offsets were deleted during the withdrawal process, therefore these offsets
will need to be re-added (if they did exist prior to the withdrawal).

Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file, <I>Marker Offsets</I> section:
<PRE>
        update MRK_Offset
        set offset = <I>original MGD offset</I>
        where _Marker_key = <I>original key</I> and source = 0

	insert MRK_Offset (_Marker_key, source, offset)
	values(<I>original key</I>, 1, <I>original CC offset</I>)

	insert MRK_Offset (_Marker_key, source, offset)
	values(<I>original key</I>, 2, <I>original MIT offset</I>)
</PRE>
 
<HR>
<H4><A NAME="otherUpdate">Reverse changes to the Other Names record(s)</A></H4>
 
The following fields need to be set back to their original values in the
<I>MRK_Other</I> table:
<OL>
<LI>Marker key (<I>MRK_Other._Marker_key</I>)
</OL>
 
Using the <I>MRK_Broadcast.sql.MarkerSymbol.rpt</I> file, <I>Marker Other</I> section:
<PRE>
        update MRK_Other
        set _Marker_key = <I>original key</I>
        where _Marker_key = <I>new key</I>
</PRE>
 
<HR>
<H4><A NAME="mlcUpdate">Reverse changes to the MLC record(s)</A></H4>
 
All MLC Text reversals have to be handled manually by the MLC Editors.  Contact Richard
Baldarelli to help you.

<HR>
<H4><A NAME="nameSymbolReferenceUpdate">Reverse changes to the Marker Name, Marker Symbol and Marker Reference record(s)</A></H4>
 
After all updates have been completed, the <I>MRK_Name</I>, <I>MRK_Symbol</I> and <I>MRK_Reference</I>
records need to be updated for all symbols affected by the reversal.  This includes the withdrawn
symbol and all of the new symbols.
<P>
Execute the utility:
	<PRE>
	titan:$SYBASE/admin/utilities/MRK/createMRK.sh $DSQUERY $MGD
	</PRE>
to rebuild the <I>MRK_Name</I>, <I>MRK_Symbol</I> and <I>MRK_Reference</I> tables in their entirety.
<P>
<B>OR</B>
<P>
Execute the utility:
	<PRE>
	titan:$SYBASE/admin/utilities/MRK/updateMRK.sh $DSQUERY $MGD <I>Marker key</I>
	</PRE>
to reload the <I>MRK_Name</I>, <I>MRK_Symbol</I> and <I>MRK_Reference</I> records for a specific
Marker.

<PRE>



























</PRE>
</BODY>
</HTML>


--
-- VerifyDate
--
--	Verify Date for Text or Table - must be in YYYY format
--	If Text, assumes use of mgiDate template
--	If Table, assumes table.date is defined as column value
--

	VerifyDate does
	  sourceWidget : widget := VerifyDate.source_widget;
	  dateTop : widget := VerifyDate.source_widget.ancestor_by_class("XmRowColumn");
	  top : widget := sourceWidget.top;
	  isTable : boolean;
	  value : string;

	  -- These variables are only relevant for Tables
	  row : integer;
	  column : integer;
	  reason : integer;

	  isTable := mgi_tblIsTable(sourceWidget);

	  if (isTable) then
	    row := VerifyDate.row;
	    column := VerifyDate.column;
	    reason := VerifyDate.reason;
	    value := VerifyDate.value;

	    -- If date column is not defined, return

	    if (sourceWidget.is_defined("date") = nil) then
	      return;
	    end if;

	    -- If not in the date column, return

	    if (column != sourceWidget.date) then
	      return;
	    end if;

	    if (reason = TBL_REASON_VALIDATE_CELL_END) then
	      return;
	    end if;
	  else
	    value := dateTop->Date->text.value;
	  end if;

	  -- If the Date is null or contains a wildcard, return

	  if (value.length = 0 or strstr(value, "%") != nil) then
	    if (not isTable) then
              (void) XmProcessTraversal(top, XmTRAVERSE_NEXT_TAB_GROUP);
	    end if;
	    return;
	  end if;

	  (void) busy_cursor(top);

          validDate : string := mgi_year(value);
 
	  -- If date is not valid
	  --   Display an error message, disallow edit to date field

          if (validDate.length > 0) then
	    if (not isTable) then
              (void) XmProcessTraversal(top, XmTRAVERSE_NEXT_TAB_GROUP);
	    end if;
	  else
	    if (isTable) then
	      VerifyDate.doit := (integer) false;
	    end if;
            StatusReport.source_widget := top.root;
            StatusReport.message := "Must enter a valid Year (YYYY) in Date field.";
            send(StatusReport);
            top.allowEdit := false;
          end if;

	  (void) reset_cursor(top);
	end does;

